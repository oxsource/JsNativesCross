<html>
<head>
    <title>JSChannel SDK</title>
    <meta charset="UTF-8"/>
    <script src="../js/natives.js"></script>
</head>
<body>
<p>This is a test page.</p>
<p id="console"></p>
<p id="gyroscope"></p>
<button onclick="showToast()">显示Toast</button>
<button onclick="printLog()">打印日志</button>
<button onclick="takePhoto()">获取图片</button>
<button onclick="obtainContract()">获取通讯录</button>
</body>
<script type='text/javascript'>
        const natives = window._natives;
        const Print = {
            console: function(payload){
                const {count, msg} = payload
                document.getElementById('console').innerText = `count=${count}, msg=${msg}`;
                return {code: count, who: 'consoleInJs@Print'};
            }
        }
        const Gyroscope = {
            send: function(e){
                document.getElementById('gyroscope').innerText = `${e}`;
            }
        }
        natives.inject({Print, Gyroscope});
        //ready

        async function init(){await natives.invoke("Console/i", "js natives bridge is ready.");}
        init()

        async function showToast(){
            try{
                await natives.invoke("Alert/showToast", "Hello， This is from javascript.")
                alert("弹出Toast成功");
            }catch(e){
                alert(`弹出Toast失败:${e}`);
            }
        }

        async function printLog(){
            await natives.invoke("Console/i", "web view call showToast");
            alert("打印日志成功");
        }

        function takePhoto(){
            //mode: 'album|camera'
            //limit: 1~N, > 1 just support by album mode
            const payload = {mode: "album", limit: 3}
            natives.invoke("Photo/take", payload).then(result => {
                //result:{data: [xxx, xxx]}
                alert("获取照片成功:" + JSON.stringify(result));
            }).catch(err => {
                alert("获取照片失败:" + err);
            });
        }

        async function obtainContract(){
            const payload = {}
            const result = await natives.invoke("Contract/simples", payload);
            //result:{data: [xxx, xxx]}
            alert("获取通讯录成功:" + JSON.stringify(result));
        }

</script>
</html>